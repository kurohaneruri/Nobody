# 调试剧本加载问题指南

## 已完成的修复

1. ? 添加了 dialog 插件（文件选择对话框）
2. ? 添加了 fs 插件（文件系统读取）
3. ? 修复了前端类型定义（Technique 和 Faction）
4. ? 添加了详细的错误日志

## 重新启动应用

**重要**：由于添加了新的 Rust 依赖，必须重新启动应用！

```bash
# 停止当前运行的应用（Ctrl+C）
# 然后重新运行
npm run tauri dev
```

## 查看错误信息

现在应用会显示详细的错误信息。请按以下步骤操作：

### 1. 打开开发者工具

在应用窗口中按 `F12` 或 `Ctrl+Shift+I` 打开浏览器开发者工具。

### 2. 切换到 Console 标签

在开发者工具中点击 "Console" 标签。

### 3. 尝试加载剧本

1. 点击"新游戏"
2. 点击"自定义剧本"
3. 选择 `example_scripts/test_script.json`

### 4. 查看日志

在 Console 中你应该看到类似这样的日志：

```
Opening file dialog...
Selected file: D:\Nobody\example_scripts\test_script.json
Calling load_script command...
Loaded script: { id: "test_cultivation_world", ... }
Initializing game...
Game initialized successfully
```

### 5. 如果出现错误

如果看到错误，请：

1. **复制完整的错误信息**（包括堆栈跟踪）
2. **查看终端日志**（运行 `npm run tauri dev` 的终端窗口）
3. **告诉我具体的错误信息**

## 常见错误和解决方案

### 错误 1: "Failed to parse script JSON"

**原因**：JSON 格式错误

**解决方案**：
- 检查 `test_script.json` 文件格式
- 确保所有引号、逗号、括号都正确
- 使用 JSON 验证工具检查

### 错误 2: "Script validation failed: No cultivation realms defined"

**原因**：剧本缺少必需字段

**解决方案**：
- 确保剧本包含至少 1 个修仙境界
- 确保剧本包含至少 1 个地点
- 检查 `starting_location` 是否存在于地点列表中

### 错误 3: "Script file not found"

**原因**：文件路径错误或文件不存在

**解决方案**：
- 确保 `example_scripts/test_script.json` 文件存在
- 检查文件路径是否正确

### 错误 4: "Permission denied"

**原因**：文件系统权限不足

**解决方案**：
- 确保应用有读取文件的权限
- 尝试将文件复制到其他位置（如桌面）再加载

## 下一步

如果仍然遇到问题，请提供：

1. **完整的错误信息**（从 Console）
2. **终端日志**（从运行 `npm run tauri dev` 的窗口）
3. **操作系统版本**
4. **文件路径**（你选择的文件完整路径）

这些信息将帮助我快速定位和解决问题。
